/*****************************************************************************
*
* Rokko: Integrated Interface for libraries of eigenvalue decomposition
*
* Copyright (C) 2012-2019 by Synge Todo <wistaria@phys.s.u-tokyo.ac.jp>
*
* Distributed under the Boost Software License, Version 1.0. (See accompanying
* file LICENSE_1_0.txt or copy at http://www.boost.org/LICENSE_1_0.txt)
*
*****************************************************************************/

#include <stdio.h>
#include <cblas.h>
#include <rokko/cmatrix.h>

int main() {
  int n = 4;
  double** a = alloc_dmatrix(n, n);
  mat_elem(a, 0, 0) = 0.959291425205444;
  mat_elem(a, 0, 1) = 0.257508254123736;
  mat_elem(a, 0, 2) = 0.243524968724989;
  mat_elem(a, 0, 3) = 0.251083857976031;
  mat_elem(a, 1, 0) = 0.547215529963803;
  mat_elem(a, 1, 1) = 0.840717255983663;
  mat_elem(a, 1, 2) = 0.929263623187228;
  mat_elem(a, 1, 3) = 0.616044676146639;
  mat_elem(a, 2, 0) = 0.138624442828679;
  mat_elem(a, 2, 1) = 0.254282178971531;
  mat_elem(a, 2, 2) = 0.349983765984809;
  mat_elem(a, 2, 3) = 0.473288848902729;
  mat_elem(a, 3, 0) = 0.149294005559057;
  mat_elem(a, 3, 1) = 0.814284826068816;
  mat_elem(a, 3, 2) = 0.196595250431208;
  mat_elem(a, 3, 3) = 0.351659507062997;
  double** b = alloc_dmatrix(n, n);
  mat_elem(b, 0, 0) = 0.567821640725221;
  mat_elem(b, 0, 1) = 0.779167230102011;
  mat_elem(b, 0, 2) = 0.469390641058206;
  mat_elem(b, 0, 3) = 0.794284540683907;
  mat_elem(b, 1, 0) = 0.0758542895630636;
  mat_elem(b, 1, 1) = 0.934010684229183;
  mat_elem(b, 1, 2) = 0.0119020695012414;
  mat_elem(b, 1, 3) = 0.311215042044805;
  mat_elem(b, 2, 0) = 0.0539501186666072;
  mat_elem(b, 2, 1) = 0.129906208473730;
  mat_elem(b, 2, 2) = 0.337122644398882;
  mat_elem(b, 2, 3) = 0.528533135506213;
  mat_elem(b, 3, 0) = 0.530797553008973;
  mat_elem(b, 3, 1) = 0.568823660872193;
  mat_elem(b, 3, 2) = 0.162182308193243;
  mat_elem(b, 3, 3) = 0.165648729499781;
  double** c = alloc_dmatrix(n, n);
  mat_elem(c, 0, 0) = 0.601981941401637;
  mat_elem(c, 0, 1) = 0.748151592823710;
  mat_elem(c, 0, 2) = 0.913337361501670;
  mat_elem(c, 0, 3) = 0.996134716626886;
  mat_elem(c, 1, 0) = 0.262971284540144;
  mat_elem(c, 1, 1) = 0.450541598502498;
  mat_elem(c, 1, 2) = 0.152378018969223;
  mat_elem(c, 1, 3) = 0.0781755287531837;
  mat_elem(c, 2, 0) = 0.654079098476782;
  mat_elem(c, 2, 1) = 0.0838213779969326;
  mat_elem(c, 2, 2) = 0.825816977489547;
  mat_elem(c, 2, 3) = 0.442678269775446;
  mat_elem(c, 3, 0) = 0.689214503140008;
  mat_elem(c, 3, 1) = 0.228976968716819;
  mat_elem(c, 3, 2) = 0.538342435260057;
  mat_elem(c, 3, 3) = 0.106652770180584;
  double alpha = 2.1;
  double beta = 0.8;

  printf("a: "); fprint_dmatrix(stdout, n, n, a);
  printf("b: "); fprint_dmatrix(stdout, n, n, b);
  printf("c: "); fprint_dmatrix(stdout, n, n, c);

  cblas_dgemm(CblasColMajor, CblasNoTrans, CblasNoTrans, n, n, n, alpha, mat_ptr(a),
              n, mat_ptr(b), n, beta, mat_ptr(c), n);

  printf("%10.5f * a * b + %10.5f * c: ", alpha, beta); fprint_dmatrix(stdout, n, n, c);

  free_dmatrix(a);
  free_dmatrix(b);
  free_dmatrix(c);
}

/* gemm.m

A = [0.959291425205444,0.257508254123736,0.243524968724989,0.251083857976031;0.547215529963803,0.840717255983663,0.929263623187228,0.616044676146639;0.138624442828679,0.254282178971531,0.349983765984809,0.473288848902729;0.149294005559057,0.814284826068816,0.196595250431208,0.351659507062997]
B = [0.567821640725221,0.779167230102011,0.469390641058206,0.794284540683907;0.0758542895630636,0.934010684229183,0.0119020695012414,0.311215042044805;0.0539501186666072,0.129906208473730,0.337122644398882,0.528533135506213;0.530797553008973,0.568823660872193,0.162182308193243,0.165648729499781]
C = [0.601981941401637,0.748151592823710,0.913337361501670,0.996134716626886;0.262971284540144,0.450541598502498,0.152378018969223,0.0781755287531837;0.654079098476782,0.0838213779969326,0.825816977489547,0.442678269775446;0.689214503140008,0.228976968716819,0.538342435260057,0.106652770180584]
2.1 * A * B + 0.8 * C

*/
